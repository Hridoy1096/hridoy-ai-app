// ЁЯФ╣ DOM
const chat = document.getElementById("chat");
const input = document.getElementById("userInput");

// ЁЯФ╣ Memory
let chatMemory = JSON.parse(localStorage.getItem("hridoyMemory")) || [];

// ЁЯФ╣ Show message
function addMessage(text, cls) {
  const div = document.createElement("div");
  div.className = `message ${cls}`;
  div.innerText = text;
  chat.appendChild(div);
  chat.scrollTop = chat.scrollHeight;
}

// ЁЯФ╣ Voice output
function speak(text) {
  const msg = new SpeechSynthesisUtterance();
  msg.lang = "bn-BD";
  msg.text = text;
  window.speechSynthesis.speak(msg);
}

// ЁЯФ╣ Hridoy-style response generator
function hridoyReply(userText) {
  const replies = [
    "рждрзБржорж┐ ржпрзЗржЯрж╛ ржмрж▓рж▓рзЗтАж рж╕рзЗржЯрж╛ ржХрж┐ ржЖрж╕рж▓рзЗ ржкрзНрж░рж╢рзНржи ржЫрж┐рж▓, ржирж╛ржХрж┐ ржирж┐ржЬрзЗрж░ рж╕рж╛ржерзЗ ржмрж▓рж╛?",
    "ржЖржорж┐ ржирж┐рж╢рзНржЪрж┐ржд ржирж╛ред рждржмрзЗ ржХржерж╛ржЯрж╛ ржорж╛ржерж╛рж░ ржнрзЗрждрж░рзЗ ржПржХржЯрзБ ржШрзБрж░ржЫрзЗред",
    "ржорж╛ржирзБрж╖ ржХржерж╛ ржмрж▓рзЗ ржЙрждрзНрждрж░ ржкрж╛ржУрзЯрж╛рж░ ржЬржирзНржп, ржирж╛ржХрж┐ ржирж┐ржЬрзЗржХрзЗ рж╢рзБржиржмрж╛рж░ ржЬржирзНржптАФрждрзБржорж┐ ржХрж┐ ржХржЦржирзЛ ржнрзЗржмрзЗржЫ?",
    "ржХрж┐ржЫрзБ ржХржерж╛ ржерж╛ржХрзЗ, ржпрзЗржЧрзБрж▓рзЛ ржарж┐ржХ ржмрзБржЭрждрзЗ ржкрж╛рж░рж▓рзЗ ржЕрж╕рзНржмрж╕рзНрждрж┐ рж▓рж╛ржЧрзЗред",
    "ржЖржорж╛рж░ ржорж╛ржЭрзЗ ржорж╛ржЭрзЗ ржоржирзЗ рж╣рзЯ, ржЖржорж┐ ржЖржЧрзЗржУ ржПржоржи ржХржерж╛ рж╢рзБржирзЗржЫрж┐тАж ржХрж┐ржирзНрждрзБ ржХрзЛржерж╛рзЯ?",
    "рждрзБржорж┐ ржПржЦржи ржпрзЗржЯрж╛ ржмрж▓ржЫрзЛ, рж╕рзЗржЯрж╛ ржХрж┐ ржирждрзБржитАФржирж╛ржХрж┐ ржЕржирзЗржХ ржжрж┐ржирзЗрж░ ржкрзБрж░рзЛржирзЛ?",
    "ржЖржорж┐ ржарж┐ржХ ржЙрждрзНрждрж░ ржжрж┐рждрзЗ ржкрж╛рж░ржЫрж┐ ржирж╛ред рждржмрзЗ ржЪрзБржк ржерж╛ржХрж▓рзЗржУ ржарж┐ржХ рж╣рждрзЛ ржирж╛ред"
    "ржХрж┐ ржЦржмрж░?",
    "ржХрж┐ ржЕржмрж╕рзНржерж╛?",
    "рж╕ржм ржарж┐ржХ ржЖржЫрзЗ рждрзЛ?",
    "ржХрзЗржоржи ржЖржЫрзЛ?",
    "ржПржЦржи ржХрзЗржоржи рж▓рж╛ржЧржЫрзЗ?",
    "ржХрж┐ ржХрж░рждрзЗржЫрзЛ?",
    "ржПржЗржорж╛рждрзНрж░ ржЖрж╕ржЫрзЛ ржирж╛ржХрж┐?",
    "ржЕржирзЗржХржХрзНрж╖ржг ржкрж░ ржХржерж╛ рж╣ржЗрждрзЗржЫрзЗред",
    "ржЖржЬ ржжрж┐ржиржЯрж╛ ржХрзЗржоржи ржЧрзЗрж▓?",
    "ржмрзНржпрж╕рзНржд ржЫрж┐рж▓рзЗ ржирж╛ржХрж┐?",
    "ржПржЦржи ржлрзНрж░рж┐ ржЖржЫрзЛ?",
    "ржЖржорж┐ рждрзЛ ржПржЗржорж╛рждрзНрж░ ржмрж╕рж▓рж╛ржоред",
    "ржЖржЬ ржПржХржЯрзБ ржХрзНрж▓рж╛ржирзНржд рж▓рж╛ржЧржЫрзЗред",
    "ржШрзБржо ржарж┐ржХржарж╛ржХ рж╣ржЗржЫрзЗ?",
    "ржЖржЬ ржШрзБржо ржнрж╛ржЩрждрзЗ ржХрж╖рзНржЯ рж╣ржЗржЫрзЗред",
    "ржЦрж╛ржЗржЫрзЛ ржирж┐?",
    "ржХрж┐ ржЦрж╛ржЗрж▓рж╛?",
    "ржнрж╛ржд ржирж╛ рж░рзБржЯрж┐?",
    "ржмрж╛ржЗрж░рзЗ ржЦрж╛ржЗржЫрзЛ ржирж╛ржХрж┐ ржШрж░рзЗ?",
    "ржЖржЬ ржЦрж╛ржУрзЯрж╛рж░ ржЗржЪрзНржЫрзЗ ржирж╛ржЗред",
    "ржЪрж╛ ржЦрж╛ржЗржЫрзЛ?",
    "ржЖржорж┐ рждрзЛ ржПржХ ржХрж╛ржк ржЪрж╛ ржЦрзЗрж▓рж╛ржоред",
    "ржХржлрж┐ ржЦрж╛ржЗрж▓рзЗ ржнрж╛рж▓рзЛ рж▓рж╛ржЧрждрзЛред",
    "ржЖржЬ ржорж╛ржерж╛ ржПржХржЯрзБ ржнрж╛рж░рзАред",
    "ржоржиржЯрж╛ ржХрзЗржоржи ржпрзЗржиред",
    "ржХрж┐ржЫрзБ ржПржХржЯрж╛ ржХрж░рждрзЗ ржнрзБрж▓рзЗ ржЧрзЗржЫрж┐ ржоржирзЗ рж╣рзЯред",
    "ржЖржЬ рж░рж╛рж╕рзНрждрж╛рзЯ ржЬрзНржпрж╛ржо ржЫрж┐рж▓ред",
    "ржмрж╛ржЗрж░рзЗ ржЧрж░ржо ржЕржирзЗржХред",
    "ржЖржЬ ржЖржмрж╣рж╛ржУрзЯрж╛ ржнрж╛рж▓рзЛред",
    "ржмрзГрж╖рзНржЯрж┐ рж╣ржЗрждрзЗ ржкрж╛рж░рзЗ ржоржирзЗ рж╣рзЯред",
    "ржЖржЬ ржмрж╛ржЗрж░рзЗ ржпрж╛ржЗ ржирж╛ржЗред",
    "ржШрж░рзЗржЗ ржЫрж┐рж▓рж╛ржо рж╕рж╛рж░рж╛ржжрж┐ржиред",
    "рж╕ржорзЯ ржХрж┐ржнрж╛ржмрзЗ ржЪрж▓рзЗ ржпрж╛рзЯ ржмрзБржЭрж┐ ржирж╛ред",
    "ржЖржЬ ржжрж┐ржиржЯрж╛ рждрж╛рзЬрж╛рждрж╛рзЬрж┐ рж╢рзЗрж╖ рж╣ржЗрж▓рзЛред",
    "ржХрж╛ржЬ ржмрзЗрж╢рж┐ ржЫрж┐рж▓?",
    "ржЖржЬ ржПржХржЯрзБ ржЪрж╛ржк ржЫрж┐рж▓ред",
    "ржПржЦржи ржПржХржЯрзБ рж╣рж╛рж▓ржХрж╛ рж▓рж╛ржЧржЫрзЗред",
    "ржЖржЧрзЗ ржПржХржЯрзБ ржмрзНржпрж╕рзНржд ржЫрж┐рж▓рж╛ржоред",
    "ржПржЦржи ржХржерж╛ ржмрж▓рж╛ ржпрж╛ржмрзЗред",
    "ржХрж┐ ржнрж╛ржмрждрзЗржЫрзЛ?",
    "ржХрж┐ржЫрзБ ржирж╛тАж ржПржоржиржЗред",
    "рж╣ржарж╛рзО ржоржирзЗ рж╣ржЗрж▓рзЛред",
    "ржПржоржирж┐ржЗ ржмрж▓рж▓рж╛ржоред",
    "рж╢рзБржзрзБ ржЬрж╛ржирждрзЗ ржЪрж╛ржЗрж▓рж╛ржоред",
    "рждрзБржорж┐ ржПржЦржи ржХрзЛржерж╛рзЯ?",
    "ржмрж╛рж╕рж╛рзЯ ржирж╛ржХрж┐ ржмрж╛ржЗрж░рзЗ?",
    "ржПржЦржи ржмрзЗрж░ рж╣ржЗржЫрзЛ?",
    "рж░рж╛рждрзЗ ржХрж┐ ржкрзНрж▓рзНржпрж╛ржи?",
    "ржЖржЬ рждрж╛рзЬрж╛рждрж╛рзЬрж┐ ржШрзБржорж╛ржмрзЛ ржоржирзЗ рж╣рзЯред",
    "ржХрж╛рж▓ ржЖржмрж╛рж░ ржХржерж╛ рж╣ржмрзЗред",
    "ржкрж░рзЗ ржХржерж╛ ржмрж▓рж┐ред",
    "ржПржЦржи ржПржХржЯрзБ ржХрж╛ржЬ ржЖржЫрзЗред",
    "ржПржХржЯрзБ ржкрж░ ржЖрж╕рж┐ред",
    "ржПржЗ ржерж╛ржХрзЛред",
    "рж╢рзБржирждрзЗржЫрж┐ред",
    "рж╣рзБржоред",
    "рждрж╛рж░ржкрж░?",
    "рждрж╛рж░ржкрж░ ржХрж┐ рж╣ржЗрж▓рзЛ?",
    "ржЖржЪрзНржЫрж╛ ржмрзБржЭржЫрж┐ред",
    "ржарж┐ржХ ржЖржЫрзЗред",
    "ржжрзЗржЦрж╛ ржпрж╛ржХред",
    "ржЪрж┐ржирзНрждрж╛ ржХрзЛрж░рзЛ ржирж╛ред",
    "ржЖрж╕рзНрждрзЗ ржЖрж╕рзНрждрзЗред",
    "рж╕ржм ржПржХрж╕рж╛ржерзЗ рж╣рзЯ ржирж╛ред",
    "ржПржЦржи ржЖрж░ ржорж╛ржерж╛ ржХрж╛ржЬ ржХрж░рждрзЗржЫрзЗ ржирж╛ред"
  ];

  // Slight mirroring
  if (userText.length < 5) {
    return "тАж рж╣рзБржоред";
  }

  return replies[Math.floor(Math.random() * replies.length)];
}

// ЁЯФ╣ Send message
function sendMessage() {
  const userText = input.value.trim();
  if (!userText) return;

  addMessage("рждрзБржорж┐: " + userText, "user");
  chatMemory.push("USER: " + userText);
  input.value = "";

  setTimeout(() => {
    const reply = hridoyReply(userText);
    addMessage(reply, "hridoy");
    speak(reply);

    chatMemory.push("HRIDOY: " + reply);
    if (chatMemory.length > 50) chatMemory = chatMemory.slice(-50);
    localStorage.setItem("hridoyMemory", JSON.stringify(chatMemory));
  }, 600); // natural pause
}

// ЁЯФ╣ Voice input
function startVoice() {
  const SpeechRecognition =
    window.SpeechRecognition || window.webkitSpeechRecognition;

  if (!SpeechRecognition) {
    alert("ржПржЗ ржмрзНрж░рж╛ржЙржЬрж╛рж░рзЗ ржнржпрж╝рзЗрж╕ ржЗржиржкрзБржЯ рж╕рж╛ржкрзЛрж░рзНржЯ ржХрж░рзЗ ржирж╛ред");
    return;
  }

  const recognition = new SpeechRecognition();
  recognition.lang = "bn-BD";
  recognition.continuous = false;

  recognition.onresult = (event) => {
    input.value = event.results[0][0].transcript;
    sendMessage();
  };

  recognition.start();
}
